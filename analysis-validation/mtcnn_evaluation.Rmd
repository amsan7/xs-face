---
title: "mtcnn evaluation"
output: html_document
---

500 frames were taken across all groups, half of them labeled as containing a face and half with no face.
```{r}
library(tidyverse)
library(magrittr)
```

Load data
```{r, message=FALSE, warning=FALSE}
setwd("..")
data <- read_csv("data/final_output/mtcnn3.csv") %>%
  distinct(video, frame, .keep_all = TRUE)

ground_truth_data <- read_csv("data/ground_truth/ground_truth3.csv") %>%
  select(-angle)
```

For openpose only 
```{r}
data <- read_csv("data/final_output/openpose_results_truncated.csv") %>%
  distinct(name, frame, .keep_all = TRUE)
```

```{r}
contains_face <- function(n, l, r) {
  return(n != 0)
}
```

```{r}
data2 <- data %>%
  mutate(is_face = (LEye_conf != 0 | REye_conf != 0) | Nose_conf != 0) %>%
  select(group, name, frame, is_face) %>%
  rename(video = name)
```

Join
```{r}
combined <- data2 %>%
  rename(detector_is_face = is_face) %>%
  inner_join(ground_truth_data, by = c("group", "video", "frame"))
```
openpose, annoying
```{r}
combined %<>% 
  mutate(detector_is_face = ifelse(detector_is_face == TRUE, "True", "False"))
```

Eval function
```{r}
evaluate <- function(a, b) {
  if (a == "True") {
    if (a == b) return ("TP")
    else return("FN")
  }
  else {
    if (a == b) return("TN")
    else return("FP")
  }
}
```

Evaluate
```{r}
results <- combined %>%
  rowwise() %>%
  mutate(result = evaluate(is_face, detector_is_face))
```

Precison / Recall / F-score
```{r}
score <- results %>%
  group_by(result) %>%
  summarise(count = n())

p <- score[4,2] / (score[4,2] + score[2,2])
r <- score[4,2] / (score[4,2] + score[1,2])
f <- 2 * p * r / (p + r)

print(paste("P:", round(p,3), "R:", round(r,3), "F:", round(f,3)))
```

