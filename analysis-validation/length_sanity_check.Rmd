---
title: "xsface - file length sanity checking"
author: "Mike Frank"
date: "July 11, 2016"
output:
  html_document:
  toc: true
---

The goal of this document is to document processing steps for the xsface data and ensure that three different datasets match up:

1. source files for movies
2. demographic sheet (containing session lengths)
3. detector outputs

```{r}
rm(list=ls())
library(readr)
library(magrittr)
library(dplyr)
library(lubridate)
```

read in lengths on movies

```{r}
demo <- read_csv("../data/demographics/demographics.csv")
movies <- read_csv("../data/video_stats/new_movie_lengths.csv") 
dets <- read_csv("../data/final_output/mtcnn3.csv")
```

Clean up measurements. 

```{r}
demo %<>% 
  rename(recorded_len = len_seconds)

## movie lengths
movies$frameCount=movies$fps*movies$length
movies %<>% 
  rename(last_frame_movie = frameCount, 
         length_movie = length) 

# standardize
dets$frame=as.numeric(dets$frame)
dets$subid=dets$video

det.lens <- dets %>%
  group_by(subid) %>%
  summarise(frames_dets = max(frame))
```

Merge. 

```{r}
all_data <- left_join(demo, movies) %>%
  left_join(det.lens) %>%
  select(subid, recorded_len, last_frame_movie, length_movie, frames_dets) %>%
  mutate(det_frame_err = abs(last_frame_movie - frames_dets) > 100,
         demo_time_err = abs(recorded_len - length_movie) > 1) %>%
  data.frame
```

Print. 

```{r}
knitr::kable(all_data, digits = 2)
```

Explanations of discrepancies:

+ 0825 - unknown, ~500 frames off (15s), spot checks seem to match decently well. 
+ 1205, 1211, and 1225 were post-trimed, hypothesis is that the _QT files are wrappers to source files that trim length to appropriate? 
+ 1628 and 1639 both off by a lot of frames, unknown.

to check in the videos
+ 1229 is reported to be much longer in the demographics file, perhaps this is post-trimming? 
+ 1612 is reported to be shorter than it is, check this. 
+ 1622 is reported to be longer than it is, check this. 
